<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Contracts Documentation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>
    <header class="bg-primary text-light py-3">
        <div class="container">
            <h1>Tech Contracts Documentation</h1>
            <p class="lead">Comprehensive guide to our smart contract architecture</p>
        </div>
    </header>

    <main class="container my-5">
        <div class="row">
            <div class="col-md-3">
                <nav class="nav flex-column">
                    <a class="nav-link" href="#overview">Overview</a>
                    <a class="nav-link" href="#payment">Payment Processing</a>
                    <a class="nav-link" href="#security">Security Model</a>
                    <a class="nav-link" href="#upgrades">Upgrade Pattern</a>
                    <a class="nav-link" href="#development">Development Setup</a>
                </nav>
            </div>
            <div class="col-md-9">
                <section id="overview" class="guide-section">
                    <h2>Overview</h2>
                    <p>
                        Our smart contracts are designed to facilitate decentralized content streaming and payment processing. 
                        They ensure secure and efficient interactions between users, creators, and the platform.
                    </p>
                </section>

                <section id="payment" class="guide-section">
                    <h2>Payment Processing</h2>
                    <p>
                        The payment processing mechanism ensures fair distribution of funds between creators and the platform treasury.
                    </p>
                    <div class="code-block">
<pre><code class="language-solidity">// Calculate platform fee
uint256 platformFee = (msg.value * platformFeePercent) / 10000;

// Transfer platform fee to treasury
(bool platformTransferSuccess, ) = platformTreasury.call{value: platformFee}("");
require(platformTransferSuccess, "Platform fee transfer failed");

// Transfer remaining payment to creator
(bool creatorTransferSuccess, ) = creator.call{value: msg.value - platformFee}("");
require(creatorTransferSuccess, "Creator payment failed");

// Grant content access through StreamAccessContract
IStreamAccess accessContract = IStreamAccess(accessContractAddress);
uint256 accessDuration = contentAccessDuration[creator][contentId];
accessContract.grantAccess(msg.sender, contentId, block.timestamp + accessDuration);

emit PaymentProcessed(msg.sender, creator, contentId, msg.value);
return true;</code></pre>
                    </div>

                    <p>The diagram below illustrates the typical flow between contracts during common user actions:</p>

                    <div class="diagram-container">
                        <img src="/assets/images/contract-flow-diagram.png" alt="Contract Interaction Flow" class="arch-diagram">
                        <p class="text-center text-muted mt-2">Figure 2: Contract interaction flow</p>
                    </div>
                </section>

                <section id="security" class="guide-section">
                    <h2>Security Model</h2>
                    <p>
                        Our smart contracts implement multiple security measures to protect user assets and content:
                    </p>
                    
                    <h3>Access Control</h3>
                    <p>
                        All contracts use OpenZeppelin's AccessControl pattern with defined roles:
                    </p>
                    <ul>
                        <li><strong>DEFAULT_ADMIN_ROLE</strong>: Can grant and revoke other roles</li>
                        <li><strong>UPGRADER_ROLE</strong>: Can upgrade proxy implementations</li>
                        <li><strong>PAUSER_ROLE</strong>: Can pause contract functionality in emergencies</li>
                        <li><strong>CONTENT_MANAGER_ROLE</strong>: Can manage content parameters</li>
                    </ul>

                    <h3>Reentrancy Protection</h3>
                    <p>
                        All external calls are made after state changes to prevent reentrancy attacks, following the checks-effects-interactions pattern.
                    </p>

                    <h3>Formal Verification</h3>
                    <p>
                        Critical contract components undergo formal verification using Certora Prover to mathematically prove security properties.
                    </p>

                    <h3>Audit History</h3>
                    <p>
                        Our contracts have been audited by multiple security firms:
                    </p>
                    <ul>
                        <li>Core contracts: OpenZeppelin (June 2023)</li>
                        <li>Payment contracts: ChainSecurity (August 2023)</li>
                        <li>Access control contracts: Trail of Bits (September 2023)</li>
                    </ul>

                    <p>
                        <a href="https://github.com/idl3o/gh-pages/security" class="btn btn-outline-primary">View Security Reports</a>
                    </p>
                </section>

                <section id="upgrades" class="guide-section">
                    <h2>Upgrade Pattern</h2>
                    <p>
                        To enable future improvements while maintaining security, we implement the Transparent Proxy Pattern:
                    </p>
                    
                    <ul>
                        <li>Core logic is separated from storage</li>
                        <li>Proxy contracts delegate calls to implementation contracts</li>
                        <li>Implementations can be upgraded by authorized admin roles</li>
                        <li>Timelock enforces 48-hour delay on upgrades</li>
                    </ul>

                    <h3>Upgrade Process</h3>
                    <ol>
                        <li>New implementation is deployed and verified on Etherscan</li>
                        <li>Upgrade is proposed through Timelock</li>
                        <li>48-hour waiting period allows users to review changes</li>
                        <li>Upgrade is executed if no critical issues are found</li>
                        <li>Users are notified of the upgrade and any new features</li>
                    </ol>
                </section>

                <section id="development" class="guide-section">
                    <h2>Development Setup</h2>
                    <p>
                        For developers interested in interacting with or contributing to our smart contracts:
                    </p>

                    <h3>Development Environment</h3>
                    <p>
                        Our contracts are developed using:
                    </p>
                    <ul>
                        <li>Hardhat - Development framework</li>
                        <li>Solidity 0.8.17 - Smart contract language</li>
                        <li>TypeScript - Testing and deployment scripts</li>
                        <li>OpenZeppelin - Security libraries</li>
                    </ul>

                    <h3>Local Setup</h3>
                    <div class="code-block">
<pre><code class="language-bash"># Clone the repository
git clone https://github.com/idl3o/web3-streaming-contracts.git

# Install dependencies
npm install

# Compile contracts
npx hardhat compile

# Run tests
npx hardhat test

# Deploy to local network
npx hardhat node
npx hardhat run scripts/deploy.ts --network localhost</code></pre>
                    </div>

                    <h3>Contract Addresses</h3>
                    <p>
                        For interacting with deployed contracts, see our <a href="/docs/contract-addresses.html">Contract Addresses</a> page.
                    </p>
                </section>
            </div>
        </div>
    </main>

    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Web3 Crypto Streaming Service</h5>
                    <p>A decentralized platform for content streaming built on blockchain technology</p>
                </div>
                <div class="col-md-3">
                    <h6>Resources</h6>
                    <ul class="list-unstyled">
                        <li><a href="/docs" class="text-light">Documentation</a></li>
                        <li><a href="/whitepaper/web3-streaming-service-whitepaper.html" class="text-light">Whitepaper</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>Community</h6>
                    <ul class="list-unstyled">
                        <li><a href="https://github.com/idl3o/gh-pages" class="text-light">GitHub</a></li>
                    </ul>
                </div>
            </div>
            <hr class="mt-4">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-0">&copy; 2024 Web3 Crypto Streaming Service. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">Version 0.9.0-beta.1</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize syntax highlighting
            hljs.highlightAll();
            
            // Theme toggle functionality
            const themeToggle = document.querySelector('.theme-toggle');
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');

            // Check for saved theme preference or use system preference
            if (localStorage.getItem('theme') === 'dark' ||
                (localStorage.getItem('theme') !== 'light' && prefersDarkScheme.matches)) {
                document.body.classList.add('dark-mode');
            }

            // Handle theme toggle click
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
                localStorage.setItem('theme', theme);
            });
        });
    </script>
</body>
</html>